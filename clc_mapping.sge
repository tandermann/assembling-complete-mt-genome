#$ -cwd
#$ -q node0
#$ -pe mpich 1
#$ -S /bin/bash

for file in /nobackup/data14/tobias/april_2015/topaza/trimmed_reads/output/trimmed_files/*; do sample=$(basename "$file") && mkdir $sample-results && echo "start assembly of $sample" && /state/partition3/CLC-AssemblyCell/clc-assembly-cell-4.3.0-linux_64/clc_assembler --cpus $NSLOTS -o $sample-results/$sample-contigs.fst -e $sample-results/$sample-fragment-size_info.txt -p fb ss 200 800 -q -i $file/$sample-READ1.fastq $file/$sample-READ2.fastq && echo "start mapping reads against contigs of $sample" && /state/partition3/CLC-AssemblyCell/clc-assembly-cell-4.3.0-linux_64/clc_mapper --cpus $NSLOTS -o $sample-results/$sample.cas -p fb ss 200 800 -q -i $file/$sample-READ1.fastq $file/$sample-READ2.fastq -d $sample-results/$sample-contigs.fst && /state/partition3/CLC-AssemblyCell/clc-assembly-cell-4.3.0-linux_64/clc_mapping_info -c -n $sample-results/$sample.cas > $sample-results/$sample-mapping_info.txt && /state/partition3/CLC-AssemblyCell/clc-assembly-cell-4.3.0-linux_64/clc_sequence_info -l -k -n $sample-results/$sample-contigs.fst > $sample-results/$sample-sequence_info.txt && /state/partition3/CLC-AssemblyCell/clc-assembly-cell-4.3.0-linux_64/clc_sequence_info -l -k -n -c 200 $sample-results/$sample-contigs.fst > $sample-results/$sample-sequence_info_200.txt && /state/partition3/CLC-AssemblyCell/clc-assembly-cell-4.3.0-linux_64/clc_sequence_info -l -k -n -c 500 $sample-results/$sample-contigs.fst > $sample-results/$sample-sequence_info_500.txt && /state/partition3/CLC-AssemblyCell/clc-assembly-cell-4.3.0-linux_64/clc_sequence_info -l -k -n -c 1000 $sample-results/$sample-contigs.fst > $sample-results/$sample-sequence_info_1000.txt && /state/partition3/CLC-AssemblyCell/clc-assembly-cell-4.3.0-linux_64/clc_sequence_info -l -k -n -c 5000 $sample-results/$sample-contigs.fst > $sample-results/$sample-sequence_info_5000.txt && echo "**********finished with $sample**********"; done
